1. Надо запустить VPN с IP не в РФ, т.к. у проекта elastic запрет на скачивание с IP в РФ
2. Скачиваем
   ```
   https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.16.2-x86_64.rpm
   https://artifacts.elastic.co/downloads/kibana/kibana-7.16.2-x86_64.rpm
   https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.16.2-x86_64.rpm
   ```
3. Добавить в /playbook/roles/elastic/defaults/main: \
   ``` elasticsearch_package: "elasticsearch-{{ elasticsearch_version }}-x86_64.rpm"```
4. Добавить файл upload_rpm.yml в директорию /playbook/roles/elastic/tasks
   ```
   ---
   - name: Upload Elasticsearch .rpm file containing binaries from local storage
     copy:
       src: "{{ elasticsearch_package }}"
       dest: "/tmp/elasticsearch-{{ elasticsearch_version }}-x86_64.rpm"
     register: download_elasticsearch_binaries
     until: download_elasticsearch_binaries is succeeded   
   ```
5. Заменить содержание /playbook/roles/elastic/tasks/main.yml на
   ```
   ---
   - import_tasks: precheck.yml
   - name: Check files directory exists
     file:
       name: files/
       state: directory
     run_once: true
     delegate_to: localhost
   - include_tasks: "upload_{{ ansible_facts.pkg_mgr }}.yml"
   - include_tasks: "install_{{ ansible_facts.pkg_mgr }}.yml"
   - import_tasks: configure.yml
   ```

P.S. Правки в role elastic добавлял руками, т.к. было мало времени форкать и править исходный репозиторий. Прошу прощения. \
На всякий случай прикладываю вывод работы команд.

```
(ansible) (base) Reist@MacBookRIK playbook % ansible-galaxy install -r requirements.yml -p roles --force
Starting galaxy role install process
- changing role elastic from 2.1.4 to 2.1.4
- extracting elastic to /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/elastic
- elastic (2.1.4) was installed successfully
- changing role filebeat from 1.0.1 to 1.0.2
- extracting filebeat to /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/filebeat
- filebeat (1.0.2) was installed successfully
- changing role kibana from 1.0.0 to 1.0.1
- extracting kibana to /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/kibana
- kibana (1.0.1) was installed successfully
```

```
(ansible) (base) Reist@MacBookRIK playbook % ansible-playbook site.yml -i inventory/prod.yml

PLAY [Install Java] ****************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [el-instance]
ok: [kibana-instance]
ok: [filebeat-instance]

TASK [Set facts for Java 11 vars] **************************************************************************************************************************************************************************************************************************************************************************************
ok: [el-instance]
ok: [filebeat-instance]
ok: [kibana-instance]

TASK [Upload .tar.gz file containing binaries from local storage] ******************************************************************************************************************************************************************************************************************************************************
ok: [el-instance]
ok: [filebeat-instance]
ok: [kibana-instance]

TASK [Ensure installation dir exists] **********************************************************************************************************************************************************************************************************************************************************************************
ok: [filebeat-instance]
ok: [el-instance]
ok: [kibana-instance]

TASK [Extract java in the installation directory] **********************************************************************************************************************************************************************************************************************************************************************
skipping: [el-instance]
skipping: [filebeat-instance]
skipping: [kibana-instance]

TASK [Export environment variables] ************************************************************************************************************************************************************************************************************************************************************************************
ok: [kibana-instance]
ok: [filebeat-instance]
ok: [el-instance]

PLAY [Assert Elasticsearch] ********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [el-instance]

TASK [elastic : Fail if unsupported system detected] *******************************************************************************************************************************************************************************************************************************************************************
skipping: [el-instance]

TASK [elastic : Check files directory exists] **************************************************************************************************************************************************************************************************************************************************************************
ok: [el-instance -> localhost]

TASK [elastic : include_tasks] *****************************************************************************************************************************************************************************************************************************************************************************************
included: /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/elastic/tasks/upload_yum.yml for el-instance

TASK [elastic : Upload Elasticsearch .rpm file containing binaries from local storage] *********************************************************************************************************************************************************************************************************************************
ok: [el-instance]

TASK [elastic : include_tasks] *****************************************************************************************************************************************************************************************************************************************************************************************
included: /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/elastic/tasks/install_yum.yml for el-instance

TASK [elastic : Install Elasticsearch] *********************************************************************************************************************************************************************************************************************************************************************************
ok: [el-instance]

TASK [elastic : Configure Elasticsearch] *******************************************************************************************************************************************************************************************************************************************************************************
ok: [el-instance]

PLAY [Assert Kibana] ***************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [kibana-instance]

TASK [kibana : Check files directory exists] ***************************************************************************************************************************************************************************************************************************************************************************
ok: [kibana-instance -> localhost]

TASK [kibana : include_tasks] ******************************************************************************************************************************************************************************************************************************************************************************************
included: /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/kibana/tasks/upload_rpm.yml for kibana-instance

TASK [kibana : Upload Kibana .rpm file containing binaries from local storage] *****************************************************************************************************************************************************************************************************************************************
ok: [kibana-instance]

TASK [kibana : include_tasks] ******************************************************************************************************************************************************************************************************************************************************************************************
included: /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/kibana/tasks/install_yum.yml for kibana-instance

TASK [kibana : Install Kibana from rpm package] ************************************************************************************************************************************************************************************************************************************************************************
ok: [kibana-instance]

TASK [kibana : Configure Kibana] ***************************************************************************************************************************************************************************************************************************************************************************************
changed: [kibana-instance]

RUNNING HANDLER [kibana : restart Kibana] ******************************************************************************************************************************************************************************************************************************************************************************
changed: [kibana-instance]

PLAY [Assert Filebeat] *************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [filebeat-instance]

TASK [filebeat : Check files directory exists] *************************************************************************************************************************************************************************************************************************************************************************
ok: [filebeat-instance -> localhost]

TASK [filebeat : include_tasks] ****************************************************************************************************************************************************************************************************************************************************************************************
included: /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/filebeat/tasks/upload_rpm.yml for filebeat-instance

TASK [filebeat : Upload Filebeat .rpm file containing binaries from local storage] *************************************************************************************************************************************************************************************************************************************
ok: [filebeat-instance]

TASK [filebeat : include_tasks] ****************************************************************************************************************************************************************************************************************************************************************************************
included: /Users/Reist/Documents/devops-netology/part_3/ansible_roles_hw/playbook/roles/filebeat/tasks/install_yum.yml for filebeat-instance

TASK [filebeat : Install Filebeat from rpm package] ********************************************************************************************************************************************************************************************************************************************************************
ok: [filebeat-instance]

TASK [filebeat : Configure Filebeat] ***********************************************************************************************************************************************************************************************************************************************************************************
changed: [filebeat-instance]

TASK [filebeat : Set filebeat systemwork] ******************************************************************************************************************************************************************************************************************************************************************************
changed: [filebeat-instance]

TASK [filebeat : Load Kibana dashboard] ********************************************************************************************************************************************************************************************************************************************************************************
FAILED - RETRYING: [filebeat-instance]: Load Kibana dashboard (3 retries left).

ok: [filebeat-instance]

RUNNING HANDLER [filebeat : restart Filebeat] **************************************************************************************************************************************************************************************************************************************************************************
changed: [filebeat-instance]

PLAY RECAP *************************************************************************************************************************************************************************************************************************************************************************************************************
el-instance                : ok=12   changed=0    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
filebeat-instance          : ok=15   changed=3    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
kibana-instance            : ok=13   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
```